<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Flip Runner</title>
<style>
  :root{
    --bg:#04020b;
    --floor:#0a1020;
    --player:#7cffd6;
    --obstacle:#ff6b6b;
    --text:#e9f8f3;
    --muted:#95a8b3;
  }
  html,body{margin:0;padding:0;height:100%;background:var(--bg);display:flex;justify-content:center;align-items:center;font-family:sans-serif;overflow:hidden;}
  canvas{background:linear-gradient(180deg,#041123,#020512);display:block;}
  .hud{position:absolute;top:16px;left:16px;color:var(--text);font-weight:bold;font-size:18px;}
  .btn{position:absolute;top:16px;right:16px;padding:8px 12px;background:rgba(255,255,255,0.05);border:none;color:var(--text);cursor:pointer;border-radius:8px;font-weight:bold;}
</style>
</head>
<body>
<div class="hud">Score: <span id="score">0</span></div>
<button class="btn" id="restartBtn" style="display:none;">Restart</button>
<canvas id="gameCanvas"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let W = canvas.width = 1000;
let H = canvas.height = 400;

// resize for mobile
function resizeCanvas(){
  const ratio = 16/9;
  let width = window.innerWidth - 32;
  let height = window.innerHeight - 32;
  if(width/height>ratio) width = height*ratio;
  else height = width/ratio;
  canvas.style.width = width+'px';
  canvas.style.height = height+'px';
}
window.addEventListener('resize',resizeCanvas);
resizeCanvas();

// Game state
let player = {x:150,y:H-60,w:40,h:40,vY:0,onGround:true,flipped:false};
let obstacles = [];
let speed = 6;
let score = 0;
let gameOver = false;

// Controls
let input = false;
function flip(){
  if(gameOver) return;
  player.flipped = !player.flipped;
  player.vY = 0;
}
window.addEventListener('keydown',e=>{if(e.code==='Space') flip();});
canvas.addEventListener('pointerdown',flip);

// Obstacles
function spawnObstacle(){
  let h = 40 + Math.random()*40;
  let y = player.flipped ? 0 : H - h;
  obstacles.push({x:W+20,y:h===0?0:y,w:20,h:h});
}

// Restart
const restartBtn = document.getElementById('restartBtn');
restartBtn.addEventListener('click',()=>{
  player.y = H-60; player.vY=0; player.flipped=false; obstacles=[]; speed=6; score=0; gameOver=false; restartBtn.style.display='none'; requestAnimationFrame(gameLoop);
});

// Main loop
let lastTime = performance.now();
let spawnTimer = 0;
function gameLoop(now){
  let dt = now - lastTime;
  lastTime = now;
  if(gameOver) return;

  // Clear
  ctx.clearRect(0,0,W,H);

  // Player physics
  const gravity = 0.7;
  if(player.flipped){
    player.vY -= gravity;
    if(player.y<0){player.y=0;player.vY=0;player.onGround=true;}
    else player.onGround=false;
  } else {
    player.vY += gravity;
    if(player.y+player.h>H){player.y=H-player.h;player.vY=0;player.onGround=true;}
    else player.onGround=false;
  }
  player.y += player.vY;

  // Draw player
  ctx.fillStyle='#7cffd6';
  ctx.fillRect(player.x,player.y,player.w,player.h);

  // Obstacles
  spawnTimer += dt;
  if(spawnTimer>1200){
    spawnTimer=0;
    spawnObstacle();
  }
  for(let i=obstacles.length-1;i>=0;i--){
    obstacles[i].x -= speed;
    ctx.fillStyle='#ff6b6b';
    ctx.fillRect(obstacles[i].x,obstacles[i].y,obstacles[i].w,obstacles[i].h);
    // collision
    if(player.x<obstacles[i].x+obstacles[i].w &&
       player.x+player.w>obstacles[i].x &&
       player.y<obstacles[i].y+obstacles[i].h &&
       player.y+player.h>obstacles[i].y){
         gameOver=true;
         restartBtn.style.display='block';
    }
    if(obstacles[i].x+obstacles[i].w<0) obstacles.splice(i,1);
  }

  // Score
  score += dt*0.01;
  document.getElementById('score').textContent = Math.floor(score);

  // Draw floor and ceiling
  ctx.fillStyle='#0a1020';
  ctx.fillRect(0,H-10,W,10);
  ctx.fillRect(0,0,W,10);

  if(!gameOver) requestAnimationFrame(gameLoop);
}
requestAnimationFrame(gameLoop);
</script>
</body>
</html>
